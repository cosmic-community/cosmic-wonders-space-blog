---
// src/components/PostCard.astro
import type { Post } from '../types';
import CategoryBadge from './CategoryBadge.astro';

export interface Props {
  post: Post;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;

const imageUrl = post.metadata?.featured_image?.imgix_url;
const author = post.metadata?.author;
const categories = post.metadata?.categories || [];
const excerpt = post.metadata?.excerpt || '';
---

<article class:list={[
  'group relative bg-gradient-card rounded-2xl overflow-hidden border border-white/10 hover:border-white/20 transition-all duration-300 hover:shadow-cosmic',
  featured ? 'md:col-span-2 md:row-span-2' : ''
]}>
  <a href={`/posts/${post.slug}`} class="block">
    <!-- Image -->
    <div class:list={[
      'relative overflow-hidden',
      featured ? 'aspect-[16/9]' : 'aspect-[16/10]'
    ]}>
      {imageUrl ? (
        <img
          src={`${imageUrl}?w=${featured ? 1200 : 800}&h=${featured ? 675 : 500}&fit=crop&auto=format,compress`}
          alt={post.title}
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          loading="lazy"
        />
      ) : (
        <div class="w-full h-full bg-gradient-to-br from-cosmic-600 to-space-600 flex items-center justify-center">
          <svg class="w-16 h-16 text-white/30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
      )}
      <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
      
      <!-- Categories -->
      {categories.length > 0 && (
        <div class="absolute top-4 left-4 flex flex-wrap gap-2">
          {categories.slice(0, 2).map((category) => (
            <CategoryBadge category={category} size="sm" />
          ))}
        </div>
      )}
    </div>
    
    <!-- Content -->
    <div class="p-6">
      <h3 class:list={[
        'font-bold text-white group-hover:text-cosmic-300 transition-colors line-clamp-2 mb-3',
        featured ? 'text-2xl md:text-3xl' : 'text-lg md:text-xl'
      ]}>
        {post.metadata?.title || post.title}
      </h3>
      
      {excerpt && (
        <p class:list={[
          'text-white/60 line-clamp-2 mb-4',
          featured ? 'text-base' : 'text-sm'
        ]}>
          {excerpt}
        </p>
      )}
      
      <!-- Author -->
      {author && (
        <div class="flex items-center gap-3">
          {author.metadata?.avatar?.imgix_url ? (
            <img
              src={`${author.metadata.avatar.imgix_url}?w=80&h=80&fit=crop&auto=format,compress`}
              alt={author.metadata?.name || author.title}
              class="w-8 h-8 rounded-full object-cover"
            />
          ) : (
            <div class="w-8 h-8 rounded-full bg-cosmic-600 flex items-center justify-center">
              <span class="text-xs font-bold text-white">
                {(author.metadata?.name || author.title).charAt(0)}
              </span>
            </div>
          )}
          <span class="text-sm text-white/60">
            {author.metadata?.name || author.title}
          </span>
        </div>
      )}
    </div>
  </a>
</article>