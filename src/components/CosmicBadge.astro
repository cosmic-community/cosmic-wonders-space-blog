---
// src/components/CosmicBadge.astro
export interface Props {
  bucketSlug: string;
}

const { bucketSlug } = Astro.props;
---

<div id="cosmic-badge-container">
  <script define:vars={{ bucketSlug }} is:inline>
    (function() {
      const isDismissed = localStorage.getItem('cosmic-badge-dismissed');
      if (isDismissed) return;
      
      const badge = document.createElement('a');
      badge.id = 'cosmic-badge';
      badge.href = `https://www.cosmicjs.com?utm_source=bucket_${bucketSlug}&utm_medium=referral&utm_campaign=app_badge&utm_content=built_with_cosmic`;
      badge.target = '_blank';
      badge.rel = 'noopener noreferrer';
      badge.innerHTML = `
        <button id="cosmic-dismiss" style="
          position: absolute;
          top: -8px;
          right: -8px;
          width: 24px;
          height: 24px;
          background: #6b7280;
          border: none;
          border-radius: 50%;
          color: white;
          font-size: 16px;
          font-weight: bold;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background-color 0.2s;
          z-index: 10;
        ">Ã—</button>
        <img src="https://cdn.cosmicjs.com/b67de7d0-c810-11ed-b01d-23d7b265c299-logo508x500.svg" 
             alt="Cosmic Logo" 
             style="width: 20px; height: 20px;">
        Built with Cosmic
      `;
      
      Object.assign(badge.style, {
        position: 'fixed',
        bottom: '20px',
        right: '20px',
        display: 'flex',
        alignItems: 'center',
        gap: '8px',
        color: 'white',
        textDecoration: 'none',
        fontSize: '14px',
        fontWeight: '500',
        backgroundColor: '#11171A',
        padding: '12px 16px',
        width: '180px',
        borderRadius: '8px',
        zIndex: '50',
        boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
        transition: 'background-color 0.2s ease',
        fontFamily: 'system-ui, -apple-system, sans-serif'
      });
      
      document.body.appendChild(badge);
      
      const dismissBtn = document.getElementById('cosmic-dismiss');
      if (dismissBtn) {
        dismissBtn.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          badge.remove();
          localStorage.setItem('cosmic-badge-dismissed', 'true');
        };
        
        dismissBtn.onmouseenter = function() {
          dismissBtn.style.backgroundColor = '#374151';
        };
        dismissBtn.onmouseleave = function() {
          dismissBtn.style.backgroundColor = '#6b7280';
        };
      }
      
      badge.onmouseenter = function() {
        badge.style.backgroundColor = '#1a2326';
      };
      badge.onmouseleave = function() {
        badge.style.backgroundColor = '#11171A';
      };
    })();
  </script>
</div>