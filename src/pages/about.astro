---
// src/pages/about.astro
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getAboutPage, getAuthors } from '../lib/cosmic';

const aboutPage = await getAboutPage();
const authors = await getAuthors();

// Default content if no Cosmic content exists
const defaultContent = {
  heading: 'About Cosmic Wonders',
  subheading: 'Exploring the mysteries of the universe, one article at a time',
  content: `<p>Welcome to Cosmic Wonders, your gateway to the fascinating world of space exploration and astronomy. We are passionate about sharing the incredible discoveries, missions, and phenomena that make our universe so awe-inspiring.</p>
  <p>Our team of dedicated writers and space enthusiasts work tirelessly to bring you the latest news, in-depth articles, and captivating stories from the cosmos. Whether you're curious about distant galaxies, the latest Mars rover discoveries, or the science behind black holes, you'll find it all here.</p>
  <p>Join us on this cosmic journey as we explore the final frontier together!</p>`,
  mission_title: 'Our Mission',
  mission_content: 'To inspire curiosity and wonder about the universe by making space science accessible, engaging, and exciting for everyone. We believe that understanding our place in the cosmos enriches our lives and drives humanity forward.',
};

const heading = aboutPage?.metadata?.heading || defaultContent.heading;
const subheading = aboutPage?.metadata?.subheading || defaultContent.subheading;
const content = aboutPage?.metadata?.content || defaultContent.content;
const heroImage = aboutPage?.metadata?.hero_image?.imgix_url;
const missionTitle = aboutPage?.metadata?.mission_title || defaultContent.mission_title;
const missionContent = aboutPage?.metadata?.mission_content || defaultContent.mission_content;
const teamTitle = aboutPage?.metadata?.team_title || 'Meet Our Team';
const teamMembers = aboutPage?.metadata?.team_members || authors;
---

<Layout title="About" description={subheading}>
  <Header />
  
  <main>
    <!-- Hero Section -->
    <section class="relative py-20 px-4 sm:px-6 lg:px-8 overflow-hidden">
      {heroImage && (
        <div class="absolute inset-0 z-0">
          <img 
            src={`${heroImage}?w=1920&h=600&fit=crop&auto=format,compress`}
            alt=""
            class="w-full h-full object-cover opacity-30"
          />
          <div class="absolute inset-0 bg-gradient-to-b from-transparent via-indigo-950/50 to-indigo-950"></div>
        </div>
      )}
      
      <div class="relative z-10 max-w-4xl mx-auto text-center">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight mb-6">
          <span class="block bg-gradient-to-r from-white via-cosmic-200 to-white bg-clip-text text-transparent">
            {heading}
          </span>
        </h1>
        {subheading && (
          <p class="text-xl md:text-2xl text-white/70 max-w-3xl mx-auto">
            {subheading}
          </p>
        )}
      </div>
    </section>
    
    <!-- Main Content Section -->
    <section class="py-16 px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <div class="prose prose-lg prose-invert mx-auto">
          <Fragment set:html={content} />
        </div>
      </div>
    </section>
    
    <!-- Mission Section -->
    {(missionTitle || missionContent) && (
      <section class="py-16 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-transparent to-cosmic-900/20">
        <div class="max-w-4xl mx-auto">
          <div class="bg-gradient-card rounded-3xl border border-white/10 p-8 md:p-12">
            <div class="flex items-center gap-4 mb-6">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cosmic-500 to-space-500 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <h2 class="text-2xl md:text-3xl font-bold text-white">{missionTitle}</h2>
            </div>
            <p class="text-lg text-white/80 leading-relaxed">
              {missionContent}
            </p>
          </div>
        </div>
      </section>
    )}
    
    <!-- Team Section -->
    {teamMembers && teamMembers.length > 0 && (
      <section class="py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
          <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">{teamTitle}</h2>
            <p class="text-lg text-white/60 max-w-2xl mx-auto">
              The passionate minds behind our cosmic explorations
            </p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {teamMembers.map((member) => (
              <a
                href={`/authors/${member.slug}`}
                class="group relative bg-gradient-card rounded-2xl border border-white/10 hover:border-white/20 p-8 transition-all duration-300 hover:shadow-cosmic text-center"
              >
                <!-- Avatar -->
                {member.metadata?.avatar?.imgix_url ? (
                  <img
                    src={`${member.metadata.avatar.imgix_url}?w=256&h=256&fit=crop&auto=format,compress`}
                    alt={member.metadata?.name || member.title}
                    class="w-24 h-24 mx-auto rounded-full object-cover ring-4 ring-white/10 group-hover:ring-cosmic-400/50 transition-all mb-6"
                  />
                ) : (
                  <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-cosmic-500 to-space-500 flex items-center justify-center ring-4 ring-white/10 group-hover:ring-cosmic-400/50 transition-all mb-6">
                    <span class="text-3xl font-bold text-white">
                      {(member.metadata?.name || member.title).charAt(0)}
                    </span>
                  </div>
                )}
                
                <!-- Name -->
                <h3 class="text-xl font-bold text-white group-hover:text-cosmic-300 transition-colors mb-2">
                  {member.metadata?.name || member.title}
                </h3>
                
                <!-- Bio -->
                {member.metadata?.bio && (
                  <p class="text-white/60 text-sm line-clamp-3">
                    {member.metadata.bio}
                  </p>
                )}
              </a>
            ))}
          </div>
        </div>
      </section>
    )}
    
    <!-- Empty State if no content -->
    {!aboutPage && authors.length === 0 && (
      <section class="py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl mx-auto text-center">
          <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-cosmic-600/20 flex items-center justify-center">
            <svg class="w-10 h-10 text-cosmic-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <p class="text-white/60">
            Add content to your "About Pages" Object Type in Cosmic to customize this page.
          </p>
        </div>
      </section>
    )}
  </main>
  
  <Footer />
</Layout>